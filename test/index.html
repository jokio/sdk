<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>MyLibrary Test</title>
</head>

<body>
    <h1>Library Test</h1>

    <button onclick="playAudio()">Edge TTS</button>

    <button onclick="playAudio2()">Voicevox TTS</button>

    <script type="module">
        // import { jok } from 'https://esm.run/@jokio/sdk';
        import { jok } from './dist/jokio.sdk.es.js';

        window.jok = jok

        window.getVoices = async function () {
            const voices = await jok.voicevoxTts.getVoices()

            console.log(voices)
        }

        window.playAudio = async function () {
            const audio = await jok.edgeTts.getAudio("Hello there, how are you?", "en-US-AvaNeural")

            audio.play()
        }

        window.playAudio2 = async function () {
            const audio = await jok.voicevoxTts.getAudio("こんにちわ、おげんきですか？あなたはあたまがいいですね。", 3)

            audio.play()
        }

        window.requestEmailLogin = async function (email) {
            const res = await jok.auth.requestEmailLogin(email, 'https://localhost:5173')

            return res
        }

        window.completeEmailLogin = async function (email, otpCode) {
            const res = await jok.auth.completeEmailLogin(email, otpCode)

            return res
        }

        window.passkeyLogin = async function (displayName) {
            const res = await jok.auth.requestPasskeyLogin(displayName)

            return res
        }

        window.natsConnect = async function () {
            await jok.nats.connect()
        }

        window.natsSubscribe = async function () {
            await jok.nats.on('test', (data, ctx) => {
                console.log(data, ctx)
                return { i: 1, b: true }
            })
        }

        window.natsCall = async function () {
            const res = await jok.nats.call('test', { name: 'User', age: 11 })

            console.log(res)
        }

        window.p2pChat = async function () {
            const k1 = await jok.crypto.createSessionKeyPair()
            const k2 = await jok.crypto.createSessionKeyPair()

            const p1 = await jok.crypto.exportPublicKey(k1.publicKey)
            const p2 = await jok.crypto.exportPublicKey(k2.publicKey)

            console.log({ p1, p2 })

            const shared1 = await jok.crypto.deriveAESKey(k1.privateKey, p2)
            const shared2 = await jok.crypto.deriveAESKey(k2.privateKey, p1)

            const originalText = "Hello World"

            const encrypted = await jok.crypto.encrypt(originalText, shared1)
            const decrypted = await jok.crypto.decrypt(encrypted, shared2)

            console.log({
                match: originalText === decrypted,
                originalText,
                decrypted,
            })
        }
    </script>

</body>

</html>